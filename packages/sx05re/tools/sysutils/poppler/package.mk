# SPDX-License-Identifier: GPL-2.0-or-later
# Copyright (C) 2019-present Shanti Gilbert (https://github.com/shantigilbert)

PKG_NAME="poppler"
PKG_VERSION="83a39c7be2148acdb267ba9a03aba991b50c3437" #21.04.0
PKG_LICENSE="GPL"
PKG_SITE="https://github.com/freedesktop/poppler"
PKG_URL="$PKG_SITE.git"
PKG_DEPENDS_TARGET="toolchain zlib libpng libjpeg-turbo boost"
PKG_LONGDESC="The poppler pdf rendering library "
PKG_TOOLCHAIN="cmake"


pre_configure_target() { 
PKG_CMAKE_OPTS_TARGET="-DENABLE_LIBOPENJPEG=none \
                       -DENABLE_GLIB=ON \
                       -DENABLE_QT5=off \
                       -DENABLE_CPP=off"
                       
# Disable "gobject-introspection"
sed -i "s|set(HAVE_INTROSPECTION \${INTROSPECTION_FOUND})|set(HAVE_INTROSPECTION "NO")|g" ${PKG_BUILD}/CMakeLists.txt
}

post_makeinstall_target() {
    mkdir -p $INSTALL/usr/bin/batocera
    ln -sf /usr/bin/pdftoppm $INSTALL/usr/bin/batocera/pdftoppm
    ln -sf /usr/bin/pdfinfo $INSTALL/usr/bin/batocera/pdfinfo
}
